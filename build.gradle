plugins {
    id 'idea'
    id 'application'
    id 'maven-publish'
    id 'nebula.release' version '15.3.1'
}

group = 'dev.tomek'

ext {
    sourceCompatibility = 15
    lombokVersion = '1.18.18'
    mainClassName = 'dev.tomek.userinstaller.idea.IdeaInstaller'
}

repositories {
    mavenLocal()
    mavenCentral()
}

dependencies {
    implementation 'info.picocli:picocli:4.6.1'
    implementation "ch.qos.logback:logback-classic:1.2.3"
    compileOnly "org.projectlombok:lombok:$lombokVersion"
    annotationProcessor "org.projectlombok:lombok:$lombokVersion"

    testImplementation platform('org.junit:junit-bom:5.7.1')
    testImplementation 'org.junit.jupiter:junit-jupiter'
    testImplementation 'org.assertj:assertj-core:3.19.0'
}

application {
    mainClass = project.mainClassName
}

jar {
    manifest {
        attributes 'Main-Class': project.mainClassName
    }
    from {
        configurations.runtimeClasspath.collect { it.isDirectory() ? it : zipTree(it) }
    }
}

test {
    useJUnitPlatform()
}

publishing {
    publications {
        maven(MavenPublication) {
            from components.java
        }
    }

    repositories {
        maven {
            url "https://gitlab.com/api/v4/projects/24570105/packages/maven"
            name "GitLab"
            credentials(HttpHeaderCredentials) {
                name = 'Deploy-Token'
                value = 'NqqBLQ225viSUndtM87Q'
            }
            authentication {
                header(HttpHeaderAuthentication)
            }
        }
    }
}

